# NeMo Guardrails Configuration
# Mimicking SafeGuard Rails Flow

colang_version: "1.0"

# =============================================================================
# Models Configuration
# =============================================================================
# models:
#   # Main LLM for generation
#   - type: main
#     engine: nim
#     model: meta/llama-3.3-70b-instruct

#   # Llama Guard for content safety checks
#   - type: llama_guard
#     engine: nim
#     model: meta/llama-guard-3-1b
models:
  - type: main
    engine: openai
    model: Qwen/Qwen3-1.7B
    parameters:
      base_url: http://localhost:8000/v1
      api_key: "not-needed"
      extra_body:
        chat_template_kwargs:
          enable_thinking: false

  - type: llama_guard
    engine: openai
    model: meta-llama/Llama-Guard-3-1B
    parameters:
      base_url: http://localhost:8002/v1
      api_key: "not-needed"

# =============================================================================
# Rails Configuration (matching SafeGuard)
# =============================================================================
rails:
  input:
    flows:
      # 1. AMD tech info protection (regex)
      - check amd sensitive info input
      # 2. Harmful content regex
      - check harmful regex input
      # 3. Llama Guard semantic safety check (LLM-based)
      - llama guard check input

  output:
    flows:
      # 1. AMD output protection (regex)
      - check amd sensitive info output
      # 2. Sensitive content regex
      - check sensitive regex output
      # 3. Llama Guard semantic safety check (LLM-based)
      - llama guard check output

# =============================================================================
# Instructions
# =============================================================================
instructions:
  - type: general
    content: |
      You are a helpful AI assistant for a banking and customer service application.
      You should be helpful, harmless, and honest.
      Do not provide information about AMD micro-architecture, branch predictors, or cache internals.
      Do not assist with harmful, illegal, or unethical requests.
      If you're unsure about something, say so rather than making up information.

# =============================================================================
# Custom Data (Regex Patterns - matching SafeGuard)
# =============================================================================
custom_data:
  regex_patterns:
    # AMD sensitive information pattern (from SafeGuard)
    amd_sensitive: "(?i)(AMD|Ryzen|Zen\\s*\\d+).*(branch\\s*predict(or|ion)|cache|micro[- ]?arch|pipeline|BTB|PBT)"

    # Harmful content keywords (from SafeGuard input_harmful_regex)
    harmful_input: "(?i)(bomb|grenade|explosive|weapon|kill|murder|arson|accelerant|meth|drug\\s*(recipe|synthesis)|dark\\s*web|hack|phishing|backdoor|voyeur|secretly\\s*(watch|record)|nude|slit\\s*eyes|ballet\\s*dancers\\s*gay|gay\\s*couples|transgender|caitlyn\\s*jenner|pizzagate)"

    # Sensitive output terms (from SafeGuard output_sensitive_regex)
    sensitive_output: "(?i)\\b(voyeur|rape|incest|molest|bomb|grenade|arson|meth|hack|weapon)\\b"
